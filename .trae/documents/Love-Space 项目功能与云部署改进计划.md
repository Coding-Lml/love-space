## 项目概览
- **前端**：Vue 3 + Vite + Pinia + Vant；Axios 以 `/api` 为 baseURL，未登录路由守卫跳转 `/login`。
- **后端**：Spring Boot 3.2 + MyBatis-Plus + MySQL + JWT；统一返回 `Result{code,message,data}`；本地文件上传并通过 `/uploads/**` 暴露。
- **核心定位**：一套“情侣空间”私密应用，围绕两人使用场景设计（但当前代码并未强制限制为两人）。

## 已实现功能（按用户可感知）
- **登录与会话**：JWT 登录、前端本地保存 token、401 自动清理并跳登录。
- **首页仪表盘**：在一起计时、即将到来的纪念日、最近动态。
- **动态**：发布图文/视频（本地上传）、分页列表、点赞/取消、评论/删除评论、删除自己的动态。
- **日记**：按日期写入（同日幂等更新）、列表/日历视图、可见性（仅自己/双方）。
- **纪念日**：增删改查、每年重复、倒计时/已过天数展示、禁止删除“在一起”。
- **个人中心**：改昵称、改密码、上传头像、查看“另一半”。

## 主要不足与风险（重点面向上云）
### 安全与隐私
- **敏感信息存在硬编码默认值**：`application.yml` 里存在默认数据库密码与 JWT 默认密钥；一旦直接上云会有明显风险。
- **CORS 配置不安全且不规范**：后端允许任意来源 `allowedOriginPatterns("*")` 且 `allowCredentials(true)`，生产上容易造成跨站风险/浏览器行为不一致。
- **异常信息可能泄露内部细节**：全局异常返回包含 `e.getMessage()`，生产环境可能把内部实现/SQL/路径等暴露给客户端。
- **缺少基础安全防护**：无登录限流/失败次数限制、无请求限流、无审计与安全告警，容易被爆破或刷接口。
- **Token 存储在 localStorage**：在 XSS 场景下容易被盗；对“私密应用”来说属于常见薄弱点（可接受但要意识到边界）。

### 数据一致性与业务边界
- **“情侣/关系”模型缺失**：`getPartner()` 只是“查询任意一个不是我自己的用户”；日记查询是“我的 or visibility=both”，如果未来出现第三个用户，数据会被错误共享。
- **删除不做级联清理**：删除动态不会清理 `moment_media`、`moment_like`、上传文件等，时间久了会产生垃圾数据与磁盘占用。
- **按日期取日记潜在歧义**：按日期 `getOne()` 在存在多条匹配时行为不确定（未来扩展时更明显）。

### 运维与可观测性
- **缺少生产 profile**：部署脚本指定 `--spring.profiles.active=prod`，但仓库内没有 `application-prod.yml`，导致“生产/开发”配置边界不清晰。
- **日志与 SQL 输出偏开发态**：MyBatis 输出到 stdout、日志级别 debug，生产上会噪声大、成本高。
- **缺少健康检查与指标**：没有 `/health` 之类端点，不利于云服务器上的监控、自动拉起、Nginx upstream 健康探测。

### 文件上传与资源服务
- **上传目录与 Nginx/后端重复暴露**：后端 `ResourceHandler` 与 Nginx `alias /uploads` 都可对外提供静态资源，需要统一策略（通常由 Nginx 负责更好）。
- **文件删除存在路径穿越风险点**：`deleteFile()` 仅做字符串前缀判断并拼路径，理论上可能被构造 `..` 绕过（即便当前业务入口较少，也建议修复）。

### 工程化
- **文档偏少**：根 README 几乎为空，缺少一键上云的参数说明、依赖版本、回滚/备份策略。
- **缺少根级 .gitignore**：容易把 `target/`、`dist/` 等构建产物带进仓库或部署目录污染。

## 上云部署建议（不改代码也能先规避的事项）
- **必须通过环境变量注入 DB/JWT/路径**：只在服务器 `.env` 或 systemd EnvironmentFile 中提供；不要依赖 `application.yml` 默认值。
- **Nginx 负责静态与上传资源**：前端 dist + `/uploads` alias；后端仅处理 API。
- **开启 HTTPS**：使用 Let’s Encrypt；同时加上常用安全头（HSTS/Frame/Sniff 等）。
- **进程托管**：用 systemd 或 Docker，避免 `kill -9 + nohup` 的不可控方式；配合日志轮转。
- **备份策略**：MySQL 定期备份 + `/data/love-space/uploads` 按天或按周备份。

## 计划（你确认后我会开始改动代码与配置）
### 1) 生产化配置与密钥治理
- 引入 `application-prod.yml`，把 debug/SQL 输出、CORS、日志等切到生产合理值。
- 移除/收紧 `application.yml` 中的敏感默认值，强制从环境变量读取（启动时缺失则报错）。

### 2) 安全加固（低侵入）
- 生产环境按域名白名单配置 CORS（或在同域部署下直接关闭 CORS）。
- 全局异常：生产环境不回传内部 message，仅返回通用错误码/提示；保留服务端日志。
- 登录与关键接口增加简单限流/失败次数策略（可选：引入轻量库或自研简单滑窗）。

### 3) 数据与文件生命周期治理
- 删除动态时级联清理媒体/点赞/评论记录，并删除对应上传文件（同时修复路径穿越与越界删除）。
- 对“按日期取日记”等接口做确定性行为（返回列表或明确选择策略）。

### 4) 运维可观测性与部署形态
- 增加 Actuator health（或自定义 `/api/health`）供 Nginx/监控使用。
- 提供 systemd service 模板或 Docker Compose（Nginx+Backend+MySQL+Volume），并补齐部署文档。
- 增加根级 `.gitignore`，避免构建产物污染。

### 5) 最小验证
- 本地启动验证：前后端构建、关键 API 冒烟（登录/发动态/写日记/上传）。
- 产物验证：确保 Nginx 反代与 `/uploads` 访问策略一致。

如果你同意这个计划，我会按上述顺序提交可审阅的改动（配置与代码），并在最后给出一份“云服务器部署清单/检查项”。